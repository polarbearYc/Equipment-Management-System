{% extends 'base.html' %}

{% block title %}è®¾å¤‡å°è´¦è¯¦æƒ…{% endblock %}

{% block sidebar %}
<div class="sidebar">
    {% if is_admin %}
        <a href="{% url 'admin_home' %}">é¦–é¡µ</a>
        <a href="{% url 'booking_approve' %}">é¢„çº¦å®¡æ‰¹</a>
        <a href="{% url 'device_manage' %}">è®¾å¤‡ç®¡ç†</a>
        <a href="{% url 'ledger:ledger_home' %}" class="active">å°è´¦</a>
        <a href="{% url 'report_stat' %}">æŠ¥è¡¨ç»Ÿè®¡</a>
    {% elif is_manager %}
        <a href="{% url 'manager_home' %}">é¦–é¡µ</a>
        <a href="{% url 'manager_booking_approve' %}">æ ¡å¤–äººå‘˜é¢„çº¦å®¡æ‰¹</a>
        <a href="{% url 'device_manage' %}">è®¾å¤‡ç®¡ç†</a>
        <a href="{% url 'user_manage' %}">ç”¨æˆ·ç®¡ç†</a>
        <a href="{% url 'ledger:ledger_home' %}" class="active">å°è´¦</a>
        <a href="{% url 'manager_report_stat' %}">æŠ¥è¡¨ç»Ÿè®¡</a>
    {% else %}
        <a href="{% url 'admin_home' %}">é¦–é¡µ</a>
        <a href="{% url 'booking_approve' %}">é¢„çº¦å®¡æ‰¹</a>
        <a href="{% url 'device_manage' %}">è®¾å¤‡ç®¡ç†</a>
        <a href="{% url 'ledger:ledger_home' %}" class="active">å°è´¦</a>
        <a href="{% url 'report_stat' %}">æŠ¥è¡¨ç»Ÿè®¡</a>
    {% endif %}
</div>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4 px-5">
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4">è®¾å¤‡å°è´¦è¯¦æƒ…</h2>

            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">å°è´¦è®°å½• #{{ ledger.pk }}</h4>
                </div>
                <div class="card-body p-4">
                    <div class="row">
                        <div class="col-lg-6 col-md-12 mb-4">
                            <div class="card h-100 border-info">
                                <div class="card-header bg-info text-white">
                                    <h5 class="mb-0">ğŸ“‹ è®¾å¤‡ä¿¡æ¯</h5>
                                </div>
                                <div class="card-body">
                                    <p class="mb-3"><strong class="text-primary">è®¾å¤‡ç¼–å·ï¼š</strong>
                                        {% if ledger.device %}
                                            <span class="badge bg-secondary">{{ ledger.device.device_code }}</span>
                                        {% elif ledger.operation_type == 'discard' and ledger.description %}
                                            {% load ledger_tags %}
                                            <span class="badge bg-secondary">{{ ledger.description|extract_device_code }}</span>
                                        {% else %}
                                            <span class="text-muted">{{ ledger.device_name }}</span>
                                        {% endif %}
                                    </p>
                                    <p class="mb-3"><strong class="text-primary">è®¾å¤‡åç§°ï¼š</strong>{{ ledger.device_name }}</p>
                                    {% if ledger.device %}
                                    <p class="mb-3"><strong class="text-primary">ç”Ÿäº§å‚å•†ï¼š</strong>{{ ledger.device.manufacturer|default:"-" }}</p>
                                    {% endif %}
                                    <p class="mb-3"><strong class="text-primary">æ“ä½œåçŠ¶æ€ï¼š</strong>
                                        <span class="badge 
                                            {% if ledger.status_after_operation == 'available' %}bg-success
                                            {% elif ledger.status_after_operation == 'unavailable' %}bg-danger
                                            {% elif ledger.status_after_operation == 'maintenance' %}bg-warning
                                            {% else %}bg-secondary{% endif %}">
                                            {{ ledger.get_status_after_operation_display }}
                                        </span>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6 col-md-12 mb-4">
                            <div class="card h-100 border-success">
                                <div class="card-header bg-success text-white">
                                    <h5 class="mb-0">ğŸ‘¤ æ“ä½œä¿¡æ¯</h5>
                                </div>
                                <div class="card-body">
                                    <p class="mb-3"><strong class="text-primary">å€Ÿç”¨äººï¼š</strong>
                                        {% if ledger.user %}
                                            <span class="badge bg-info">{{ ledger.user.name }}</span> 
                                            <small class="text-muted">({{ ledger.user.user_code }})</small>
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </p>
                                    <p class="mb-3"><strong class="text-primary">æ“ä½œç±»å‹ï¼š</strong>
                                        <span class="badge 
                                            {% if ledger.operation_type == 'borrow' %}bg-primary
                                            {% elif ledger.operation_type == 'return' %}bg-success
                                            {% elif ledger.operation_type == 'discard' %}bg-danger
                                            {% else %}bg-secondary{% endif %}">
                                            {{ ledger.get_operation_type_display }}
                                        </span>
                                    </p>
                                    <p class="mb-3"><strong class="text-primary">æ“ä½œæ—¥æœŸï¼š</strong>{{ ledger.operation_date|date:"Y-m-d H:i:s" }}</p>
                                    <p class="mb-3"><strong class="text-primary">é¢„æœŸå½’è¿˜æ—¶é—´ï¼š</strong>
                                        {% if ledger.expected_return_date %}
                                            {{ ledger.expected_return_date|date:"Y-m-d H:i:s" }}
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </p>
                                    <p class="mb-3"><strong class="text-primary">å®é™…å½’è¿˜æ—¶é—´ï¼š</strong>
                                        {% if ledger.actual_return_date %}
                                            {{ ledger.actual_return_date|date:"Y-m-d H:i:s" }}
                                        {% else %}
                                            <span class="text-muted">æœªå½’è¿˜</span>
                                        {% endif %}
                                    </p>
                                    <p class="mb-3"><strong class="text-primary">æ“ä½œå‘˜ï¼š</strong>{{ ledger.operator.username|default:"ç³»ç»Ÿ" }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    {% if ledger.description %}
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card border-warning">
                                <div class="card-header bg-warning text-dark">
                                    <h5 class="mb-0">ğŸ“ æ“ä½œæè¿°</h5>
                                </div>
                                <div class="card-body">
                                    <p class="mb-0">{{ ledger.description }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card border-secondary">
                                <div class="card-header bg-secondary text-white">
                                    <h5 class="mb-0">ğŸ•’ ç³»ç»Ÿä¿¡æ¯</h5>
                                </div>
                                <div class="card-body">
                                    <p class="mb-0"><strong class="text-primary">è®°å½•åˆ›å»ºæ—¶é—´ï¼š</strong>{{ ledger.created_at|date:"Y-m-d H:i:s" }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer text-end">
                    <a href="{% url 'ledger:device_ledger_list' %}" class="btn btn-secondary btn-lg">
                        <i class="fas fa-arrow-left"></i> è¿”å›åˆ—è¡¨
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}